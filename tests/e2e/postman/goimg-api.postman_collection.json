{
  "info": {
    "_postman_id": "goimg-api-e2e-tests",
    "name": "GoImg API E2E Tests",
    "description": "End-to-end API tests for the GoImg image gallery platform.\n\nThese tests validate the complete API functionality including authentication, user management, image operations, albums, and moderation workflows.\n\n## Test Organization\n\n- **Health Check**: System health and readiness\n- **Auth**: Registration, login, token refresh, logout flows\n- **Users**: Profile management, sessions, account deletion\n- **Images**: Upload, retrieve, update, delete operations\n- **Albums**: Album CRUD operations\n- **Explore**: Public discovery features\n- **E2E Flows**: Complete user journey tests\n- **Error Handling**: RFC 7807 error response validation\n\n## Running Tests\n\nTests are designed to run sequentially as they depend on previous test results (e.g., registration before login).\n\n```bash\nnewman run goimg-api.postman_collection.json -e ci.postman_environment.json\n```",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "{{BASE_URL}}"
    },
    {
      "key": "testPassword",
      "value": "SecureP@ssw0rd123!"
    }
  ],
  "item": [
    {
      "name": "Health Check",
      "item": [
        {
          "name": "Health - Liveness",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has status field', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql('ok');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health/live",
              "host": ["{{baseUrl}}"],
              "path": ["health", "live"]
            }
          }
        },
        {
          "name": "Health - Readiness",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('All services are ready', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql('ok');",
                  "    pm.expect(jsonData).to.have.property('services');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health/ready",
              "host": ["{{baseUrl}}"],
              "path": ["health", "ready"]
            }
          }
        }
      ]
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register - Success",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Generate unique test data for idempotent tests",
                  "const timestamp = Date.now();",
                  "const randomSuffix = Math.floor(Math.random() * 10000);",
                  "const uniqueId = `${timestamp}${randomSuffix}`;",
                  "",
                  "pm.collectionVariables.set('testEmail', `e2e-test-${uniqueId}@example.com`);",
                  "pm.collectionVariables.set('testUsername', `e2euser${uniqueId}`);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has correct Content-Type', function () {",
                  "    pm.response.to.have.header('Content-Type', 'application/json; charset=utf-8');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('email');",
                  "    pm.expect(jsonData).to.have.property('username');",
                  "    pm.expect(jsonData).to.have.property('displayName');",
                  "    pm.expect(jsonData).to.have.property('role');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('createdAt');",
                  "    pm.expect(jsonData).to.have.property('updatedAt');",
                  "    ",
                  "    // Store user ID for subsequent tests",
                  "    pm.collectionVariables.set('testUserId', jsonData.id);",
                  "});",
                  "",
                  "pm.test('User email matches request', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.email).to.eql(pm.collectionVariables.get('testEmail'));",
                  "});",
                  "",
                  "pm.test('User username matches request', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.username).to.eql(pm.collectionVariables.get('testUsername'));",
                  "});",
                  "",
                  "pm.test('User has default role', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.role).to.eql('user');",
                  "});",
                  "",
                  "pm.test('User status is active', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('active');",
                  "});",
                  "",
                  "pm.test('Response does not contain password', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.not.have.property('password');",
                  "    pm.expect(jsonData).to.not.have.property('passwordHash');",
                  "});",
                  "",
                  "pm.test('Response time is acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"username\": \"{{testUsername}}\",\n  \"password\": \"{{testPassword}}\",\n  \"displayName\": \"E2E Test User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Email Already Exists",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 409', function () {",
                  "    pm.response.to.have.status(409);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "    pm.expect(jsonData.status).to.eql(409);",
                  "});",
                  "",
                  "pm.test('Error indicates email conflict', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.title.toLowerCase()).to.include('conflict');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"username\": \"differentuser123\",\n  \"password\": \"{{testPassword}}\",\n  \"displayName\": \"Different User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Username Already Exists",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 409', function () {",
                  "    pm.response.to.have.status(409);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "    pm.expect(jsonData.status).to.eql(409);",
                  "});",
                  "",
                  "pm.test('Error indicates username conflict', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.title.toLowerCase()).to.include('conflict');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"different@example.com\",\n  \"username\": \"{{testUsername}}\",\n  \"password\": \"{{testPassword}}\",\n  \"displayName\": \"Different User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Register - Weak Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 400 or 422', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "});",
                  "",
                  "pm.test('Error indicates validation failure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    const title = jsonData.title.toLowerCase();",
                  "    pm.expect(title).to.satisfy(function(t) {",
                  "        return t.includes('validation') || t.includes('invalid') || t.includes('bad request');",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"weakpass@example.com\",\n  \"username\": \"weakpassuser\",\n  \"password\": \"weak\",\n  \"displayName\": \"Weak Password User\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Login - Success",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has correct Content-Type', function () {",
                  "    pm.response.to.have.header('Content-Type', 'application/json; charset=utf-8');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});",
                  "",
                  "pm.test('Response has tokens', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('accessToken');",
                  "    pm.expect(jsonData).to.have.property('refreshToken');",
                  "    pm.expect(jsonData).to.have.property('expiresIn');",
                  "    pm.expect(jsonData).to.have.property('tokenType');",
                  "    ",
                  "    // Store tokens for subsequent requests",
                  "    pm.collectionVariables.set('accessToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('user');",
                  "    pm.expect(jsonData.user).to.have.property('id');",
                  "    pm.expect(jsonData.user).to.have.property('email');",
                  "    pm.expect(jsonData.user).to.have.property('username');",
                  "});",
                  "",
                  "pm.test('Tokens are non-empty', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.accessToken.length).to.be.above(0);",
                  "    pm.expect(jsonData.refreshToken.length).to.be.above(0);",
                  "});",
                  "",
                  "pm.test('Token type is Bearer', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.tokenType).to.eql('Bearer');",
                  "});",
                  "",
                  "pm.test('ExpiresIn is positive integer', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.expiresIn).to.be.a('number');",
                  "    pm.expect(jsonData.expiresIn).to.be.above(0);",
                  "});",
                  "",
                  "pm.test('Response time is acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(3000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Login - Wrong Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Error message is generic (security)', function () {",
                  "    const jsonData = pm.response.json();",
                  "    // Should not reveal whether email exists or password is wrong",
                  "    pm.expect(jsonData.detail.toLowerCase()).to.satisfy(function(detail) {",
                  "        return detail.includes('invalid') || detail.includes('incorrect');",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{testEmail}}\",\n  \"password\": \"WrongPassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Login - Unknown User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Error message is generic (security)', function () {",
                  "    const jsonData = pm.response.json();",
                  "    // Should not reveal whether user exists - generic message",
                  "    pm.expect(jsonData.detail.toLowerCase()).to.satisfy(function(detail) {",
                  "        return detail.includes('invalid') || detail.includes('incorrect');",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nonexistent@example.com\",\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Access Protected Resource - Valid Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has user profile', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('email');",
                  "    pm.expect(jsonData).to.have.property('username');",
                  "    pm.expect(jsonData.email).to.eql(pm.collectionVariables.get('testEmail'));",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/me",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me"]
            }
          }
        },
        {
          "name": "Access Protected Resource - No Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Response has WWW-Authenticate header', function () {",
                  "    pm.response.to.have.header('WWW-Authenticate');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/me",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me"]
            }
          }
        },
        {
          "name": "Refresh Token - Success",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has correct Content-Type', function () {",
                  "    pm.response.to.have.header('Content-Type', 'application/json; charset=utf-8');",
                  "});",
                  "",
                  "pm.test('Response has new tokens', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('accessToken');",
                  "    pm.expect(jsonData).to.have.property('refreshToken');",
                  "    pm.expect(jsonData).to.have.property('expiresIn');",
                  "    pm.expect(jsonData).to.have.property('tokenType');",
                  "    ",
                  "    // Update stored tokens",
                  "    pm.collectionVariables.set('accessToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                  "});",
                  "",
                  "pm.test('New tokens are non-empty', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.accessToken.length).to.be.above(0);",
                  "    pm.expect(jsonData.refreshToken.length).to.be.above(0);",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          }
        },
        {
          "name": "Refresh Token - Invalid Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Error indicates invalid token', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.toLowerCase()).to.satisfy(function(detail) {",
                  "        return detail.includes('invalid') || detail.includes('expired') || detail.includes('token');",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"invalid.refresh.token.xyz123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          }
        },
        {
          "name": "Logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "    pm.response.to.have.status(204);",
                  "});",
                  "",
                  "pm.test('Response body is empty', function () {",
                  "    pm.expect(pm.response.text()).to.be.empty;",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});",
                  "",
                  "// Store the logged-out token for the next test",
                  "pm.collectionVariables.set('loggedOutToken', pm.collectionVariables.get('accessToken'));"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          }
        },
        {
          "name": "Access After Logout - Token Blacklisted",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Error indicates invalid or expired token', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.toLowerCase()).to.satisfy(function(detail) {",
                  "        return detail.includes('invalid') || detail.includes('expired') || detail.includes('revoked') || detail.includes('blacklist');",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{loggedOutToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/me",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me"]
            }
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Get User by ID - Success",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Re-login to get fresh tokens after logout test",
                  "const loginRequest = {",
                  "    url: pm.collectionVariables.get('baseUrl') + '/auth/login',",
                  "    method: 'POST',",
                  "    header: {",
                  "        'Content-Type': 'application/json'",
                  "    },",
                  "    body: {",
                  "        mode: 'raw',",
                  "        raw: JSON.stringify({",
                  "            email: pm.collectionVariables.get('testEmail'),",
                  "            password: pm.collectionVariables.get('testPassword')",
                  "        })",
                  "    }",
                  "};",
                  "",
                  "pm.sendRequest(loginRequest, function (err, response) {",
                  "    if (err) {",
                  "        console.error('Login failed:', err);",
                  "        return;",
                  "    }",
                  "    ",
                  "    const jsonData = response.json();",
                  "    pm.collectionVariables.set('accessToken', jsonData.accessToken);",
                  "    pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has public profile fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('username');",
                  "    pm.expect(jsonData).to.have.property('displayName');",
                  "    pm.expect(jsonData).to.have.property('bio');",
                  "    pm.expect(jsonData).to.have.property('avatarUrl');",
                  "    pm.expect(jsonData).to.have.property('createdAt');",
                  "});",
                  "",
                  "pm.test('Response does not expose private fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.not.have.property('email');",
                  "    pm.expect(jsonData).to.not.have.property('password');",
                  "    pm.expect(jsonData).to.not.have.property('passwordHash');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{testUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{testUserId}}"]
            }
          }
        },
        {
          "name": "Get User by ID - Not Found",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "    pm.expect(jsonData.status).to.eql(404);",
                  "});",
                  "",
                  "pm.test('Error indicates resource not found', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.title.toLowerCase()).to.include('not found');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/00000000-0000-0000-0000-000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["users", "00000000-0000-0000-0000-000000000000"]
            }
          }
        },
        {
          "name": "Update Own Profile - Success",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Profile is updated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.displayName).to.eql('Updated E2E User');",
                  "    pm.expect(jsonData.bio).to.eql('Updated bio from E2E tests');",
                  "});",
                  "",
                  "pm.test('Response has complete user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('email');",
                  "    pm.expect(jsonData).to.have.property('username');",
                  "    pm.expect(jsonData).to.have.property('updatedAt');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"displayName\": \"Updated E2E User\",\n  \"bio\": \"Updated bio from E2E tests\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{testUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{testUserId}}"]
            }
          }
        },
        {
          "name": "Update Another User Profile - Forbidden",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Create a second test user",
                  "const timestamp = Date.now();",
                  "const randomSuffix = Math.floor(Math.random() * 10000);",
                  "const uniqueId = `${timestamp}${randomSuffix}`;",
                  "",
                  "const registerRequest = {",
                  "    url: pm.collectionVariables.get('baseUrl') + '/auth/register',",
                  "    method: 'POST',",
                  "    header: {",
                  "        'Content-Type': 'application/json'",
                  "    },",
                  "    body: {",
                  "        mode: 'raw',",
                  "        raw: JSON.stringify({",
                  "            email: `other-user-${uniqueId}@example.com`,",
                  "            username: `otheruser${uniqueId}`,",
                  "            password: pm.collectionVariables.get('testPassword'),",
                  "            displayName: 'Other Test User'",
                  "        })",
                  "    }",
                  "};",
                  "",
                  "pm.sendRequest(registerRequest, function (err, response) {",
                  "    if (err) {",
                  "        console.error('Registration failed:', err);",
                  "        return;",
                  "    }",
                  "    ",
                  "    const userData = response.json();",
                  "    pm.collectionVariables.set('otherUserId', userData.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 403', function () {",
                  "    pm.response.to.have.status(403);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('detail');",
                  "    pm.expect(jsonData.status).to.eql(403);",
                  "});",
                  "",
                  "pm.test('Error indicates forbidden access', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.title.toLowerCase()).to.include('forbidden');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"displayName\": \"Attempted Unauthorized Update\",\n  \"bio\": \"This should fail\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{otherUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{otherUserId}}"]
            }
          }
        },
        {
          "name": "Get User Sessions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Sessions have required fields', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.length > 0) {",
                  "        const session = jsonData[0];",
                  "        pm.expect(session).to.have.property('id');",
                  "        pm.expect(session).to.have.property('userId');",
                  "        pm.expect(session).to.have.property('ipAddress');",
                  "        pm.expect(session).to.have.property('userAgent');",
                  "        pm.expect(session).to.have.property('createdAt');",
                  "        pm.expect(session).to.have.property('expiresAt');",
                  "    }",
                  "});",
                  "",
                  "pm.test('At least one session exists', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.length).to.be.above(0);",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/{{testUserId}}/sessions",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{testUserId}}", "sessions"]
            }
          }
        },
        {
          "name": "Delete Account - Wrong Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 Problem Details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Error indicates invalid credentials', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.detail.toLowerCase()).to.satisfy(function(detail) {",
                  "        return detail.includes('password') || detail.includes('invalid') || detail.includes('incorrect');",
                  "    });",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"password\": \"WrongPassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{testUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{testUserId}}"]
            }
          }
        },
        {
          "name": "Delete Account - Success",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "    pm.response.to.have.status(204);",
                  "});",
                  "",
                  "pm.test('Response body is empty', function () {",
                  "    pm.expect(pm.response.text()).to.be.empty;",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"password\": \"{{testPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{testUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{testUserId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "E2E Flows",
      "item": [
        {
          "name": "Complete Auth Journey",
          "item": [
            {
              "name": "1. Register New User",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "const timestamp = Date.now();",
                      "const randomSuffix = Math.floor(Math.random() * 10000);",
                      "const uniqueId = `${timestamp}${randomSuffix}`;",
                      "",
                      "pm.collectionVariables.set('e2eEmail', `e2e-journey-${uniqueId}@example.com`);",
                      "pm.collectionVariables.set('e2eUsername', `e2ejourney${uniqueId}`);"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('User registered successfully', function () {",
                      "    pm.response.to.have.status(201);",
                      "    const jsonData = pm.response.json();",
                      "    pm.collectionVariables.set('e2eUserId', jsonData.id);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"{{e2eEmail}}\",\n  \"username\": \"{{e2eUsername}}\",\n  \"password\": \"{{testPassword}}\",\n  \"displayName\": \"E2E Journey User\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/auth/register",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "register"]
                }
              }
            },
            {
              "name": "2. Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Login successful', function () {",
                      "    pm.response.to.have.status(200);",
                      "    const jsonData = pm.response.json();",
                      "    pm.collectionVariables.set('e2eAccessToken', jsonData.accessToken);",
                      "    pm.collectionVariables.set('e2eRefreshToken', jsonData.refreshToken);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"{{e2eEmail}}\",\n  \"password\": \"{{testPassword}}\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/auth/login",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "login"]
                }
              }
            },
            {
              "name": "3. Access Profile",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Profile accessed successfully', function () {",
                      "    pm.response.to.have.status(200);",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.email).to.eql(pm.collectionVariables.get('e2eEmail'));",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{e2eAccessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/users/me",
                  "host": ["{{baseUrl}}"],
                  "path": ["users", "me"]
                }
              }
            },
            {
              "name": "4. Update Profile",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Profile updated successfully', function () {",
                      "    pm.response.to.have.status(200);",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.bio).to.eql('E2E journey test bio');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{e2eAccessToken}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"bio\": \"E2E journey test bio\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/users/{{e2eUserId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["users", "{{e2eUserId}}"]
                }
              }
            },
            {
              "name": "5. Refresh Token",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Token refreshed successfully', function () {",
                      "    pm.response.to.have.status(200);",
                      "    const jsonData = pm.response.json();",
                      "    pm.collectionVariables.set('e2eAccessToken', jsonData.accessToken);",
                      "    pm.collectionVariables.set('e2eRefreshToken', jsonData.refreshToken);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"refreshToken\": \"{{e2eRefreshToken}}\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/auth/refresh",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "refresh"]
                }
              }
            },
            {
              "name": "6. Verify Sessions",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Sessions retrieved successfully', function () {",
                      "    pm.response.to.have.status(200);",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "    pm.expect(jsonData.length).to.be.above(0);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{e2eAccessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/users/{{e2eUserId}}/sessions",
                  "host": ["{{baseUrl}}"],
                  "path": ["users", "{{e2eUserId}}", "sessions"]
                }
              }
            },
            {
              "name": "7. Logout",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Logout successful', function () {",
                      "    pm.response.to.have.status(204);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{e2eAccessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/auth/logout",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "logout"]
                }
              }
            },
            {
              "name": "8. Verify Token Blacklisted",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Access denied with logged-out token', function () {",
                      "    pm.response.to.have.status(401);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{e2eAccessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/users/me",
                  "host": ["{{baseUrl}}"],
                  "path": ["users", "me"]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Images",
      "item": [
        {
          "name": "Upload Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has image data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('filename');",
                  "    pm.expect(jsonData).to.have.property('urls');",
                  "    pm.collectionVariables.set('testImageId', jsonData.id);",
                  "});",
                  "",
                  "pm.test('Response time is acceptable', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(10000);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "{{testImagePath}}"
                },
                {
                  "key": "title",
                  "value": "E2E Test Image",
                  "type": "text"
                },
                {
                  "key": "description",
                  "value": "Image uploaded during E2E testing",
                  "type": "text"
                },
                {
                  "key": "visibility",
                  "value": "public",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/images",
              "host": ["{{baseUrl}}"],
              "path": ["images"]
            }
          }
        },
        {
          "name": "Get Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has image details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('urls');",
                  "    pm.expect(jsonData).to.have.property('metadata');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/images/{{testImageId}}",
              "host": ["{{baseUrl}}"],
              "path": ["images", "{{testImageId}}"]
            }
          }
        },
        {
          "name": "Update Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Image is updated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.title).to.eql('Updated E2E Image');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Updated E2E Image\",\n  \"description\": \"Updated description\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/images/{{testImageId}}",
              "host": ["{{baseUrl}}"],
              "path": ["images", "{{testImageId}}"]
            }
          }
        },
        {
          "name": "List User Images",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has pagination', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('items');",
                  "    pm.expect(jsonData).to.have.property('total');",
                  "    pm.expect(jsonData).to.have.property('page');",
                  "    pm.expect(jsonData).to.have.property('pageSize');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/me/images?page=1&pageSize=10",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me", "images"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "pageSize",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "Delete Image",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/images/{{testImageId}}",
              "host": ["{{baseUrl}}"],
              "path": ["images", "{{testImageId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Albums",
      "item": [
        {
          "name": "Create Album",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has album data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('name');",
                  "    pm.expect(jsonData.name).to.eql('E2E Test Album');",
                  "    pm.collectionVariables.set('testAlbumId', jsonData.id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"E2E Test Album\",\n  \"description\": \"Album created during E2E testing\",\n  \"visibility\": \"public\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/albums",
              "host": ["{{baseUrl}}"],
              "path": ["albums"]
            }
          }
        },
        {
          "name": "Get Album",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has album details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('name');",
                  "    pm.expect(jsonData).to.have.property('images');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/albums/{{testAlbumId}}",
              "host": ["{{baseUrl}}"],
              "path": ["albums", "{{testAlbumId}}"]
            }
          }
        },
        {
          "name": "Delete Album",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 204', function () {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/albums/{{testAlbumId}}",
              "host": ["{{baseUrl}}"],
              "path": ["albums", "{{testAlbumId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Social",
      "item": [
        {
          "name": "Likes",
          "item": [
            {
              "name": "Setup - Create Test Image for Social Tests",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "// Re-login to ensure fresh token",
                      "const loginRequest = {",
                      "    url: pm.collectionVariables.get('baseUrl') + '/auth/login',",
                      "    method: 'POST',",
                      "    header: {",
                      "        'Content-Type': 'application/json'",
                      "    },",
                      "    body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "            email: pm.collectionVariables.get('testEmail'),",
                      "            password: pm.collectionVariables.get('testPassword')",
                      "        })",
                      "    }",
                      "};",
                      "",
                      "pm.sendRequest(loginRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.error('Login failed:', err);",
                      "        return;",
                      "    }",
                      "    ",
                      "    const jsonData = response.json();",
                      "    pm.collectionVariables.set('accessToken', jsonData.accessToken);",
                      "    pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 201', function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test('Image created for social tests', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.collectionVariables.set('socialTestImageId', jsonData.id);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "type": "file",
                      "src": "{{testImagePath}}"
                    },
                    {
                      "key": "title",
                      "value": "Social Test Image",
                      "type": "text"
                    },
                    {
                      "key": "description",
                      "value": "Image for testing likes and comments",
                      "type": "text"
                    },
                    {
                      "key": "visibility",
                      "value": "public",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{baseUrl}}/images",
                  "host": ["{{baseUrl}}"],
                  "path": ["images"]
                }
              }
            },
            {
              "name": "Like Image - Success",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 200', function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test('Response has correct Content-Type', function () {",
                      "    pm.response.to.have.header('Content-Type', 'application/json; charset=utf-8');",
                      "});",
                      "",
                      "pm.test('Response indicates like successful', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('liked');",
                      "    pm.expect(jsonData.liked).to.be.true;",
                      "    pm.expect(jsonData).to.have.property('like_count');",
                      "    pm.expect(jsonData.like_count).to.be.a('number');",
                      "    pm.expect(jsonData.like_count).to.be.above(0);",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});",
                      "",
                      "pm.test('Response time is acceptable', function () {",
                      "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/like",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "like"]
                }
              }
            },
            {
              "name": "Like Image - Idempotency (Like Twice)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 200', function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test('Like count remains same (idempotent)', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('liked');",
                      "    pm.expect(jsonData.liked).to.be.true;",
                      "    pm.expect(jsonData).to.have.property('like_count');",
                      "    // Count should be 1 (not incremented again)",
                      "    pm.expect(jsonData.like_count).to.eql(1);",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/like",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "like"]
                }
              }
            },
            {
              "name": "List Image Likes - With Results",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 200', function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test('Response has pagination structure', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('items');",
                      "    pm.expect(jsonData).to.have.property('pagination');",
                      "    pm.expect(jsonData.items).to.be.an('array');",
                      "});",
                      "",
                      "pm.test('At least one like exists', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.items.length).to.be.above(0);",
                      "});",
                      "",
                      "pm.test('Like objects have required fields', function () {",
                      "    const jsonData = pm.response.json();",
                      "    if (jsonData.items.length > 0) {",
                      "        const like = jsonData.items[0];",
                      "        pm.expect(like).to.have.property('user_id');",
                      "        pm.expect(like).to.have.property('user');",
                      "        pm.expect(like).to.have.property('image_id');",
                      "        pm.expect(like).to.have.property('created_at');",
                      "        pm.expect(like.user).to.have.property('id');",
                      "        pm.expect(like.user).to.have.property('username');",
                      "    }",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/likes?page=1&per_page=20",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "likes"],
                  "query": [
                    {
                      "key": "page",
                      "value": "1"
                    },
                    {
                      "key": "per_page",
                      "value": "20"
                    }
                  ]
                }
              }
            },
            {
              "name": "Unlike Image - Success",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 200', function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test('Response indicates unlike successful', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('liked');",
                      "    pm.expect(jsonData.liked).to.be.false;",
                      "    pm.expect(jsonData).to.have.property('like_count');",
                      "    pm.expect(jsonData.like_count).to.be.a('number');",
                      "    pm.expect(jsonData.like_count).to.eql(0);",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/like",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "like"]
                }
              }
            },
            {
              "name": "List Image Likes - Empty After Unlike",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 200', function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test('Response has pagination structure', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('items');",
                      "    pm.expect(jsonData).to.have.property('pagination');",
                      "});",
                      "",
                      "pm.test('Likes list is empty', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.items).to.be.an('array');",
                      "    pm.expect(jsonData.items.length).to.eql(0);",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/likes",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "likes"]
                }
              }
            },
            {
              "name": "Like Image - Unauthorized (No Token)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 401', function () {",
                      "    pm.response.to.have.status(401);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "    pm.expect(jsonData.status).to.eql(401);",
                      "});",
                      "",
                      "pm.test('Response has WWW-Authenticate header', function () {",
                      "    pm.response.to.have.header('WWW-Authenticate');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/like",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "like"]
                }
              }
            },
            {
              "name": "Like Image - Image Not Found",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 404', function () {",
                      "    pm.response.to.have.status(404);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "    pm.expect(jsonData.status).to.eql(404);",
                      "});",
                      "",
                      "pm.test('Error indicates image not found', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.title.toLowerCase()).to.include('not found');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/images/00000000-0000-0000-0000-000000000000/like",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "00000000-0000-0000-0000-000000000000", "like"]
                }
              }
            }
          ]
        },
        {
          "name": "Comments",
          "item": [
            {
              "name": "Add Comment - Success",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 201', function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test('Response has correct Content-Type', function () {",
                      "    pm.response.to.have.header('Content-Type', 'application/json; charset=utf-8');",
                      "});",
                      "",
                      "pm.test('Comment created successfully', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.expect(jsonData).to.have.property('user_id');",
                      "    pm.expect(jsonData).to.have.property('user');",
                      "    pm.expect(jsonData).to.have.property('image_id');",
                      "    pm.expect(jsonData).to.have.property('content');",
                      "    pm.expect(jsonData).to.have.property('created_at');",
                      "    ",
                      "    // Store comment ID for subsequent tests",
                      "    pm.collectionVariables.set('testCommentId', jsonData.id);",
                      "});",
                      "",
                      "pm.test('Comment content matches request', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.content).to.eql('Beautiful photo! Love the colors.');",
                      "});",
                      "",
                      "pm.test('User info is included', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.user).to.have.property('id');",
                      "    pm.expect(jsonData.user).to.have.property('username');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});",
                      "",
                      "pm.test('Response time is acceptable', function () {",
                      "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"Beautiful photo! Love the colors.\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/comments",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "comments"]
                }
              }
            },
            {
              "name": "Add Comment - Empty Content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 400 or 422', function () {",
                      "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "});",
                      "",
                      "pm.test('Error indicates validation failure', function () {",
                      "    const jsonData = pm.response.json();",
                      "    const title = jsonData.title.toLowerCase();",
                      "    pm.expect(title).to.satisfy(function(t) {",
                      "        return t.includes('validation') || t.includes('invalid') || t.includes('bad request');",
                      "    });",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/comments",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "comments"]
                }
              }
            },
            {
              "name": "Add Comment - Content Too Long",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "// Generate a comment that exceeds 1000 characters",
                      "const longComment = 'A'.repeat(1001);",
                      "pm.collectionVariables.set('longComment', longComment);"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 400 or 422', function () {",
                      "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "});",
                      "",
                      "pm.test('Error indicates validation failure', function () {",
                      "    const jsonData = pm.response.json();",
                      "    const detail = jsonData.detail.toLowerCase();",
                      "    pm.expect(detail).to.satisfy(function(d) {",
                      "        return d.includes('length') || d.includes('long') || d.includes('1000');",
                      "    });",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"{{longComment}}\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/comments",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "comments"]
                }
              }
            },
            {
              "name": "Add Comment - Special Characters and Unicode",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 201', function () {",
                      "    pm.response.to.have.status(201);",
                      "});",
                      "",
                      "pm.test('Comment with Unicode created successfully', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.expect(jsonData).to.have.property('content');",
                      "    // Verify Unicode characters preserved",
                      "    pm.expect(jsonData.content).to.include('');",
                      "    pm.expect(jsonData.content).to.include('');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"Amazing shot!    test @user #photo\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/comments",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "comments"]
                }
              }
            },
            {
              "name": "List Comments - With Results",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 200', function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test('Response has pagination structure', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('items');",
                      "    pm.expect(jsonData).to.have.property('pagination');",
                      "    pm.expect(jsonData.items).to.be.an('array');",
                      "});",
                      "",
                      "pm.test('Comments exist', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.items.length).to.be.above(0);",
                      "});",
                      "",
                      "pm.test('Comment objects have required fields', function () {",
                      "    const jsonData = pm.response.json();",
                      "    if (jsonData.items.length > 0) {",
                      "        const comment = jsonData.items[0];",
                      "        pm.expect(comment).to.have.property('id');",
                      "        pm.expect(comment).to.have.property('user_id');",
                      "        pm.expect(comment).to.have.property('user');",
                      "        pm.expect(comment).to.have.property('image_id');",
                      "        pm.expect(comment).to.have.property('content');",
                      "        pm.expect(comment).to.have.property('created_at');",
                      "        pm.expect(comment.user).to.have.property('id');",
                      "        pm.expect(comment.user).to.have.property('username');",
                      "    }",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/comments?page=1&per_page=20",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "comments"],
                  "query": [
                    {
                      "key": "page",
                      "value": "1"
                    },
                    {
                      "key": "per_page",
                      "value": "20"
                    }
                  ]
                }
              }
            },
            {
              "name": "Add Comment - Unauthorized (No Token)",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 401', function () {",
                      "    pm.response.to.have.status(401);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "    pm.expect(jsonData.status).to.eql(401);",
                      "});",
                      "",
                      "pm.test('Response has WWW-Authenticate header', function () {",
                      "    pm.response.to.have.header('WWW-Authenticate');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"This should fail without auth\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/images/{{socialTestImageId}}/comments",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "{{socialTestImageId}}", "comments"]
                }
              }
            },
            {
              "name": "Add Comment - Image Not Found",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 404', function () {",
                      "    pm.response.to.have.status(404);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "    pm.expect(jsonData.status).to.eql(404);",
                      "});",
                      "",
                      "pm.test('Error indicates image not found', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.title.toLowerCase()).to.include('not found');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  },
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"content\": \"Comment on non-existent image\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/images/00000000-0000-0000-0000-000000000000/comments",
                  "host": ["{{baseUrl}}"],
                  "path": ["images", "00000000-0000-0000-0000-000000000000", "comments"]
                }
              }
            },
            {
              "name": "Delete Comment - Author Success",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 204', function () {",
                      "    pm.response.to.have.status(204);",
                      "});",
                      "",
                      "pm.test('Response body is empty', function () {",
                      "    pm.expect(pm.response.text()).to.be.empty;",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/comments/{{testCommentId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["comments", "{{testCommentId}}"]
                }
              }
            },
            {
              "name": "Delete Comment - Comment Not Found",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 404', function () {",
                      "    pm.response.to.have.status(404);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "    pm.expect(jsonData.status).to.eql(404);",
                      "});",
                      "",
                      "pm.test('Error indicates comment not found', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.title.toLowerCase()).to.include('not found');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/comments/00000000-0000-0000-0000-000000000000",
                  "host": ["{{baseUrl}}"],
                  "path": ["comments", "00000000-0000-0000-0000-000000000000"]
                }
              }
            },
            {
              "name": "Delete Comment - Unauthorized (No Token)",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "// Create a new comment to delete in this test",
                      "const addCommentRequest = {",
                      "    url: pm.collectionVariables.get('baseUrl') + '/images/' + pm.collectionVariables.get('socialTestImageId') + '/comments',",
                      "    method: 'POST',",
                      "    header: {",
                      "        'Content-Type': 'application/json',",
                      "        'Authorization': 'Bearer ' + pm.collectionVariables.get('accessToken')",
                      "    },",
                      "    body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "            content: 'Comment for unauthorized delete test'",
                      "        })",
                      "    }",
                      "};",
                      "",
                      "pm.sendRequest(addCommentRequest, function (err, response) {",
                      "    if (err) {",
                      "        console.error('Create comment failed:', err);",
                      "        return;",
                      "    }",
                      "    ",
                      "    const jsonData = response.json();",
                      "    pm.collectionVariables.set('commentToDeleteWithoutAuth', jsonData.id);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 401', function () {",
                      "    pm.response.to.have.status(401);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData.status).to.eql(401);",
                      "});",
                      "",
                      "pm.test('Response has WWW-Authenticate header', function () {",
                      "    pm.response.to.have.header('WWW-Authenticate');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/comments/{{commentToDeleteWithoutAuth}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["comments", "{{commentToDeleteWithoutAuth}}"]
                }
              }
            },
            {
              "name": "Delete Comment - Forbidden (Not Author/Owner)",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "// Create a second user and their comment",
                      "const timestamp = Date.now();",
                      "const randomSuffix = Math.floor(Math.random() * 10000);",
                      "const uniqueId = `${timestamp}${randomSuffix}`;",
                      "",
                      "// Register second user",
                      "const registerRequest = {",
                      "    url: pm.collectionVariables.get('baseUrl') + '/auth/register',",
                      "    method: 'POST',",
                      "    header: {",
                      "        'Content-Type': 'application/json'",
                      "    },",
                      "    body: {",
                      "        mode: 'raw',",
                      "        raw: JSON.stringify({",
                      "            email: `user2-${uniqueId}@example.com`,",
                      "            username: `user2${uniqueId}`,",
                      "            password: pm.collectionVariables.get('testPassword'),",
                      "            displayName: 'Second Test User'",
                      "        })",
                      "    }",
                      "};",
                      "",
                      "pm.sendRequest(registerRequest, function (err, regResponse) {",
                      "    if (err) {",
                      "        console.error('Registration failed:', err);",
                      "        return;",
                      "    }",
                      "    ",
                      "    const userData = regResponse.json();",
                      "    pm.collectionVariables.set('user2Id', userData.id);",
                      "    ",
                      "    // Login as second user",
                      "    const loginRequest = {",
                      "        url: pm.collectionVariables.get('baseUrl') + '/auth/login',",
                      "        method: 'POST',",
                      "        header: {",
                      "            'Content-Type': 'application/json'",
                      "        },",
                      "        body: {",
                      "            mode: 'raw',",
                      "            raw: JSON.stringify({",
                      "                email: `user2-${uniqueId}@example.com`,",
                      "                password: pm.collectionVariables.get('testPassword')",
                      "            })",
                      "        }",
                      "    };",
                      "    ",
                      "    pm.sendRequest(loginRequest, function (err, loginResponse) {",
                      "        if (err) {",
                      "            console.error('Login failed:', err);",
                      "            return;",
                      "        }",
                      "        ",
                      "        const loginData = loginResponse.json();",
                      "        pm.collectionVariables.set('user2AccessToken', loginData.accessToken);",
                      "        ",
                      "        // Create comment as user 2",
                      "        const commentRequest = {",
                      "            url: pm.collectionVariables.get('baseUrl') + '/images/' + pm.collectionVariables.get('socialTestImageId') + '/comments',",
                      "            method: 'POST',",
                      "            header: {",
                      "                'Content-Type': 'application/json',",
                      "                'Authorization': 'Bearer ' + loginData.accessToken",
                      "            },",
                      "            body: {",
                      "                mode: 'raw',",
                      "                raw: JSON.stringify({",
                      "                    content: 'Comment from user 2'",
                      "                })",
                      "            }",
                      "        };",
                      "        ",
                      "        pm.sendRequest(commentRequest, function (err, commentResponse) {",
                      "            if (err) {",
                      "                console.error('Create comment failed:', err);",
                      "                return;",
                      "            }",
                      "            ",
                      "            const commentData = commentResponse.json();",
                      "            pm.collectionVariables.set('user2CommentId', commentData.id);",
                      "        });",
                      "    });",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test('Status code is 403', function () {",
                      "    pm.response.to.have.status(403);",
                      "});",
                      "",
                      "pm.test('Response follows RFC 7807 Problem Details', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('type');",
                      "    pm.expect(jsonData).to.have.property('title');",
                      "    pm.expect(jsonData).to.have.property('status');",
                      "    pm.expect(jsonData).to.have.property('detail');",
                      "    pm.expect(jsonData.status).to.eql(403);",
                      "});",
                      "",
                      "pm.test('Error indicates forbidden access', function () {",
                      "    const jsonData = pm.response.json();",
                      "    pm.expect(jsonData.title.toLowerCase()).to.include('forbidden');",
                      "});",
                      "",
                      "pm.test('Response has X-Request-ID header', function () {",
                      "    pm.response.to.have.header('X-Request-ID');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{accessToken}}"
                  }
                ],
                "url": {
                  "raw": "{{baseUrl}}/comments/{{user2CommentId}}",
                  "host": ["{{baseUrl}}"],
                  "path": ["comments", "{{user2CommentId}}"]
                }
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Explore",
      "item": [
        {
          "name": "Get Recent Images",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has pagination', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('items');",
                  "    pm.expect(jsonData).to.have.property('total');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/explore/recent?page=1&pageSize=20",
              "host": ["{{baseUrl}}"],
              "path": ["explore", "recent"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "pageSize",
                  "value": "20"
                }
              ]
            }
          }
        },
        {
          "name": "Search Images",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has search results', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('items');",
                  "    pm.expect(jsonData).to.have.property('total');",
                  "    pm.expect(jsonData).to.have.property('query');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/explore/search?q=test&page=1&pageSize=20",
              "host": ["{{baseUrl}}"],
              "path": ["explore", "search"],
              "query": [
                {
                  "key": "q",
                  "value": "test"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "pageSize",
                  "value": "20"
                }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Error Handling",
      "item": [
        {
          "name": "401 - Unauthorized Access",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 401', function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql(401);",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/me",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me"]
            }
          }
        },
        {
          "name": "404 - Resource Not Found",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 404', function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql(404);",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/images/00000000-0000-0000-0000-000000000000",
              "host": ["{{baseUrl}}"],
              "path": ["images", "00000000-0000-0000-0000-000000000000"]
            }
          }
        },
        {
          "name": "422 - Validation Error",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 422 or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 422]);",
                  "});",
                  "",
                  "pm.test('Response follows RFC 7807 with validation details', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('type');",
                  "    pm.expect(jsonData).to.have.property('title');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});",
                  "",
                  "pm.test('Response has X-Request-ID header', function () {",
                  "    pm.response.to.have.header('X-Request-ID');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"invalid-email\",\n  \"username\": \"ab\",\n  \"password\": \"weak\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        }
      ]
    }
  ]
}
