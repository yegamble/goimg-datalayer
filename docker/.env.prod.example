# ============================================================================
# Production Environment Configuration
# ============================================================================
# Copy this file to .env.prod and update with your production settings
#
# CRITICAL SECURITY NOTES:
# 1. Generate strong random secrets for ALL secret values
# 2. Use a secrets manager (AWS Secrets Manager, Vault, etc.) in real production
# 3. Never commit the actual .env.prod file to version control
# 4. Rotate secrets regularly
# 5. Use SSL/TLS for all external connections
#
# Example secret generation:
#   openssl rand -base64 64
#   openssl rand -hex 32

# ============================================================================
# Database Configuration
# ============================================================================
# CRITICAL: Change these values!
DB_USER=goimg_prod
DB_PASSWORD=CHANGE_ME_USE_STRONG_PASSWORD_MIN_32_CHARS
DB_NAME=goimg_production
DB_HOST=postgres
DB_PORT=5432
DB_SSL_MODE=require

# Connection pooling - tune based on your workload
DB_MAX_OPEN_CONNS=25
DB_MAX_IDLE_CONNS=5
DB_CONN_MAX_LIFETIME=5m

# Performance tuning - adjust based on server specs
DB_MAX_CONNECTIONS=100
DB_SHARED_BUFFERS=512MB
DB_EFFECTIVE_CACHE_SIZE=2GB
DB_WORK_MEM=8MB
DB_MAINTENANCE_WORK_MEM=128MB

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_URL=redis://redis:6379
# CRITICAL: Set a strong password!
REDIS_PASSWORD=CHANGE_ME_USE_STRONG_PASSWORD_MIN_32_CHARS
REDIS_DB=0
REDIS_MAX_RETRIES=3
REDIS_MAX_MEMORY=1gb

# ============================================================================
# JWT Configuration
# ============================================================================
# CRITICAL: Generate a cryptographically secure secret!
# Example: openssl rand -base64 64
JWT_SECRET=CHANGE_ME_GENERATE_STRONG_SECRET_MIN_64_CHARS_USE_OPENSSL_RAND_BASE64_64
JWT_EXPIRATION=24h
JWT_REFRESH_EXPIRATION=168h

# ============================================================================
# API Server Configuration
# ============================================================================
API_PORT=8080
API_HOST=0.0.0.0
API_READ_TIMEOUT=30s
API_WRITE_TIMEOUT=30s
API_IDLE_TIMEOUT=120s
API_MAX_HEADER_BYTES=1048576

# ============================================================================
# CORS Configuration
# ============================================================================
# CRITICAL: Set to your actual frontend domain(s)
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Accept,Authorization,Content-Type,X-CSRF-Token
CORS_ALLOW_CREDENTIALS=true

# ============================================================================
# Storage Configuration
# ============================================================================
# Options: s3, do-spaces, b2 (do NOT use 'local' in production)
STORAGE_PROVIDER=s3

# Local storage (NOT recommended for production - use S3-compatible storage)
# STORAGE_LOCAL_PATH=/data/uploads

# ============================================================================
# S3 / AWS S3 Configuration
# ============================================================================
# For AWS S3:
S3_ENDPOINT=
S3_REGION=us-east-1
S3_BUCKET=your-goimg-production-bucket
S3_ACCESS_KEY=CHANGE_ME_AWS_ACCESS_KEY
S3_SECRET_KEY=CHANGE_ME_AWS_SECRET_KEY
S3_USE_SSL=true

# ============================================================================
# DigitalOcean Spaces Configuration (S3-compatible)
# ============================================================================
# Uncomment and configure if using DigitalOcean Spaces:
# S3_ENDPOINT=nyc3.digitaloceanspaces.com
# S3_REGION=us-east-1
# S3_BUCKET=your-goimg-production-bucket
# S3_ACCESS_KEY=CHANGE_ME_DO_SPACES_KEY
# S3_SECRET_KEY=CHANGE_ME_DO_SPACES_SECRET
# S3_USE_SSL=true

# ============================================================================
# Backblaze B2 Configuration (S3-compatible)
# ============================================================================
# Uncomment and configure if using Backblaze B2:
# S3_ENDPOINT=s3.us-west-004.backblazeb2.com
# S3_REGION=us-west-004
# S3_BUCKET=your-goimg-production-bucket
# S3_ACCESS_KEY=CHANGE_ME_B2_KEY_ID
# S3_SECRET_KEY=CHANGE_ME_B2_APPLICATION_KEY
# S3_USE_SSL=true

# ============================================================================
# IPFS Configuration
# ============================================================================
IPFS_ENABLED=true
IPFS_API_URL=http://ipfs:5001
IPFS_GATEWAY_URL=https://ipfs.io

# Pinata (recommended for production IPFS pinning)
# Sign up at https://pinata.cloud
IPFS_PINATA_JWT=CHANGE_ME_PINATA_JWT_TOKEN

# Infura (alternative pinning service)
# Sign up at https://infura.io
IPFS_INFURA_PROJECT_ID=
IPFS_INFURA_PROJECT_SECRET=

# ============================================================================
# ClamAV Configuration
# ============================================================================
CLAMAV_HOST=clamav
CLAMAV_PORT=3310
CLAMAV_TIMEOUT=30s
CLAMAV_UPDATE_FREQUENCY=24

# ============================================================================
# Image Processing Configuration
# ============================================================================
# Maximum file size in bytes (10MB default, adjust as needed)
IMAGE_MAX_FILE_SIZE=10485760

# Allowed MIME types (comma-separated)
IMAGE_ALLOWED_TYPES=image/jpeg,image/png,image/webp,image/gif

# JPEG/WebP quality (1-100, lower = smaller files)
IMAGE_QUALITY=85

# Strip EXIF metadata (recommended for privacy)
IMAGE_STRIP_METADATA=true

# ============================================================================
# Rate Limiting Configuration
# ============================================================================
RATE_LIMIT_ENABLED=true
# Requests per window
RATE_LIMIT_REQUESTS=100
# Time window
RATE_LIMIT_WINDOW=1m

# ============================================================================
# Worker Configuration
# ============================================================================
# Number of concurrent job processors
WORKER_CONCURRENCY=10
# Queue priority: queue_name:weight
WORKER_QUEUES=critical:6,default:3,low:1

# ============================================================================
# Logging Configuration
# ============================================================================
# Levels: debug, info, warn, error
# Use 'info' or 'warn' in production
LOG_LEVEL=info
# Formats: json (recommended), text
LOG_FORMAT=json

# ============================================================================
# Observability Configuration
# ============================================================================
METRICS_ENABLED=true
METRICS_PORT=9090

# OpenTelemetry tracing (optional)
TRACING_ENABLED=false
TRACING_ENDPOINT=

# If using Jaeger:
# TRACING_ENABLED=true
# TRACING_ENDPOINT=http://jaeger:14268/api/traces

# If using Honeycomb:
# TRACING_ENABLED=true
# TRACING_ENDPOINT=https://api.honeycomb.io
# HONEYCOMB_API_KEY=CHANGE_ME

# ============================================================================
# Data Storage Paths
# ============================================================================
# Root directory for persistent data on host
DATA_ROOT=/var/lib/goimg

# ============================================================================
# Environment
# ============================================================================
ENVIRONMENT=production

# ============================================================================
# SMTP Configuration (for email notifications)
# ============================================================================
# SMTP_HOST=smtp.sendgrid.net
# SMTP_PORT=587
# SMTP_USER=apikey
# SMTP_PASSWORD=CHANGE_ME_SENDGRID_API_KEY
# SMTP_FROM=noreply@yourdomain.com
# SMTP_FROM_NAME=Your App Name

# ============================================================================
# Error Tracking Configuration (Security Gate S9-MON-002)
# ============================================================================
# Choose ONE option: Sentry (cloud) OR GlitchTip (self-hosted)
#
# For Sentry (cloud):
#   1. Sign up at https://sentry.io
#   2. Create project (Platform: Go)
#   3. Copy DSN from Settings â†’ Client Keys (DSN)
#
# For GlitchTip (self-hosted):
#   1. Deploy using docker-compose.glitchtip.yml
#   2. Create project in GlitchTip dashboard
#   3. Copy DSN from project settings
#
# The DSN format is the same for both:
# https://PUBLIC_KEY@ORGANIZATION.ingest.sentry.io/PROJECT_ID
# or
# https://PUBLIC_KEY@glitchtip.yourdomain.com/PROJECT_ID

# Sentry/GlitchTip DSN (Data Source Name)
# REQUIRED for production error tracking
SENTRY_DSN=https://YOUR_PUBLIC_KEY@YOUR_ORG.ingest.sentry.io/YOUR_PROJECT_ID

# Environment name (appears in error dashboard for filtering)
# Options: production, staging, development
SENTRY_ENVIRONMENT=production

# Release version (correlate errors with deployments)
# Format: service@version (e.g., goimg-api@1.2.3)
# Automatically uses git commit SHA if not set
SENTRY_RELEASE=goimg-api@1.0.0

# Error sampling rate (0.0 to 1.0)
# 1.0 = capture 100% of errors (recommended for production)
# 0.5 = capture 50% of errors (use for high-traffic sites)
SENTRY_SAMPLE_RATE=1.0

# Transaction/performance sampling rate (0.0 to 1.0)
# 0.1 = capture 10% of transactions (recommended, reduces overhead)
# 1.0 = capture 100% of transactions (expensive at scale)
SENTRY_TRACES_SAMPLE_RATE=0.1

# Enable debug mode (only for development, never in production)
# Logs SDK internals to console
SENTRY_DEBUG=false

# ============================================================================
# GlitchTip Self-Hosted Configuration (if using GlitchTip)
# ============================================================================
# These settings are only needed if deploying GlitchTip yourself
# See: docker/docker-compose.glitchtip.yml

# GlitchTip database password
# Generate with: openssl rand -base64 32
GLITCHTIP_DB_PASSWORD=CHANGE_ME_USE_STRONG_PASSWORD_MIN_32_CHARS

# GlitchTip Django secret key
# Generate with: openssl rand -hex 32
GLITCHTIP_SECRET_KEY=CHANGE_ME_USE_RANDOM_64_CHAR_HEX_STRING

# GlitchTip domain (for email links and webhooks)
GLITCHTIP_DOMAIN=https://glitchtip.yourdomain.com

# GlitchTip port (internal)
GLITCHTIP_PORT=8000

# GlitchTip admin credentials (for initial setup)
# After first login, change password in dashboard
GLITCHTIP_ADMIN_EMAIL=admin@yourdomain.com
GLITCHTIP_ADMIN_PASSWORD=CHANGE_ME_AFTER_FIRST_LOGIN

# Event retention period (days)
# Events older than this are automatically deleted
# Default: 90 days (compliance requirement)
GLITCHTIP_MAX_EVENT_LIFE_DAYS=90

# ============================================================================
# OAuth2 Configuration (optional)
# ============================================================================
# Google OAuth
# OAUTH_GOOGLE_CLIENT_ID=CHANGE_ME
# OAUTH_GOOGLE_CLIENT_SECRET=CHANGE_ME
# OAUTH_GOOGLE_REDIRECT_URL=https://yourdomain.com/auth/google/callback

# GitHub OAuth
# OAUTH_GITHUB_CLIENT_ID=CHANGE_ME
# OAUTH_GITHUB_CLIENT_SECRET=CHANGE_ME
# OAUTH_GITHUB_REDIRECT_URL=https://yourdomain.com/auth/github/callback

# ============================================================================
# Security Headers & Features
# ============================================================================
# Enable HSTS (HTTP Strict Transport Security)
# HSTS_MAX_AGE=31536000
# HSTS_INCLUDE_SUBDOMAINS=true

# Content Security Policy
# CSP_POLICY=default-src 'self'; img-src 'self' data: https:; script-src 'self'

# ============================================================================
# Backup Configuration
# ============================================================================
# S3 bucket for database backups (optional)
# BACKUP_S3_BUCKET=your-backup-bucket
# BACKUP_S3_REGION=us-east-1
# BACKUP_S3_ACCESS_KEY=CHANGE_ME
# BACKUP_S3_SECRET_KEY=CHANGE_ME

# Backup retention (days)
# BACKUP_RETENTION_DAYS=30

# GPG encryption for backups (optional)
# BACKUP_GPG_RECIPIENT=backup@yourdomain.com
